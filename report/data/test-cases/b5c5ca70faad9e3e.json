{"uid":"b5c5ca70faad9e3e","name":"登录接口失败测试用例","fullName":"testcases.test_login_api.TestLoginAPI#test_login","historyId":"311f1087c368c93725dbe2d28d79e478","time":{"start":1770642206411,"stop":1770642206501,"duration":90},"description":"测试登录接口，使用错误的管理员账号和密码（RSA加密密码）","descriptionHtml":"<p>测试登录接口，使用错误的管理员账号和密码（RSA加密密码）</p>\n","status":"failed","statusMessage":"AssertionError: 共 1 个断言失败:\n  - 响应字段: 期望 code=401, 实际 400","statusTrace":"self = <test_login_api.TestLoginAPI object at 0x0000024341548BF0>\ndata = {'allure': {'description': '测试登录接口，使用错误的管理员账号和密码（RSA加密密码）', 'epic': 'InvEntropy', 'feature': '登录模块', 'pytest_mark': 'a...Spr/g==', 'timestamp': 1770642206410, 'userType': 'admin', 'username': 'admin'}, 'method': 'POST', 'params': {}, ...}}}\n\n    @pytest.mark.api\n    @pytest.mark.parametrize(\"data\", read_yaml_list(\"data/test_data/login.yaml\"))\n    def test_login(self,data):\n        \"\"\"测试登录接口\"\"\"\n    \n        encryptor = PasswordEncryptor()\n        # public_key=read_yaml(\"config/extract.yaml\")[\"publicKey\"]\n        public_key = PUBLIC_KEY\n        pem_public_key = \"-----BEGIN PUBLIC KEY-----\" + public_key + \"-----END PUBLIC KEY-----\"\n        encryptor.set_public_key(pem_public_key)\n    \n        data[\"steps\"][\"request\"][\"json\"][\"password\"] = encryptor.encryptPassword(data[\"steps\"][\"request\"][\"json\"][\"password\"])\n        data[\"steps\"][\"request\"][\"json\"][\"timestamp\"] = int(time.time() * 1000)\n    \n        runner = ApiRunner(data)\n>       runner.run()\n\ntestcases\\test_login_api.py:37: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\ncommon\\api_utils.py:76: in run\n    self.core(k,v)\ncommon\\api_utils.py:62: in core\n    self.check_response(v)\ncommon\\api_utils.py:34: in check_response\n    checker.check_response(expected)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <common.response_checker.ResponseChecker object at 0x0000024341565DC0>\nexpected = {'response': {'code': 401, 'data': None, 'msg': '用户名或密码错误'}, 'status_code': 200}\n\n    def check_response(self, expected=None):\n        if expected is None:\n            logger.info(\"未设置预期结果，跳过断言\")\n            return\n    \n        errors = []\n        json_data = self.resp.json()\n        logger.info(f\"resp.json: {json_data}\")\n    \n        # 1. HTTP 状态码\n        if \"status_code\" in expected:\n            if self.resp.status_code != expected[\"status_code\"]:\n                errors.append(f\"状态码: 期望 {expected['status_code']}, 实际 {self.resp.status_code}\")\n    \n        # 2. 顶层字段 (code, msg)\n        resp_config = expected.get(\"response\", {})\n        for k, v in resp_config.items():\n            if k == \"data\":\n                continue\n            if k not in json_data:\n                errors.append(f\"缺少响应字段: {k}\")\n            elif json_data[k] != v:\n                errors.append(f\"响应字段: 期望 {k}={v!r}, 实际 {json_data[k]!r}\")\n    \n        # 3. data 层\n        data_config = resp_config.get(\"data\")\n        if data_config and \"data\" in json_data:\n            data = json_data[\"data\"]\n    \n            if \"required_fields\" in data_config:\n                for field in data_config[\"required_fields\"]:\n                    if field and field not in data:\n                        errors.append(f\"缺少字段: data.{field}\")\n    \n            if \"assert\" in data_config:\n                _run_assertions(data, data_config[\"assert\"], \"data\", errors)\n    \n            if \"list_check\" in data_config:\n                _check_list(data, data_config[\"list_check\"], \"data\", errors)\n    \n        # 4. 结果\n        if errors:\n            msg = f\"共 {len(errors)} 个断言失败:\\n\" + \"\\n\".join(f\"  - {e}\" for e in errors)\n            logger.error(msg)\n>           raise AssertionError(msg)\nE           AssertionError: 共 1 个断言失败:\nE             - 响应字段: 期望 code=401, 实际 400\n\ncommon\\response_checker.py:140: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup_and_teardown","time":{"start":1770642205995,"stop":1770642205996,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":false}],"testStage":{"description":"测试登录接口，使用错误的管理员账号和密码（RSA加密密码）","status":"failed","statusMessage":"AssertionError: 共 1 个断言失败:\n  - 响应字段: 期望 code=401, 实际 400","statusTrace":"self = <test_login_api.TestLoginAPI object at 0x0000024341548BF0>\ndata = {'allure': {'description': '测试登录接口，使用错误的管理员账号和密码（RSA加密密码）', 'epic': 'InvEntropy', 'feature': '登录模块', 'pytest_mark': 'a...Spr/g==', 'timestamp': 1770642206410, 'userType': 'admin', 'username': 'admin'}, 'method': 'POST', 'params': {}, ...}}}\n\n    @pytest.mark.api\n    @pytest.mark.parametrize(\"data\", read_yaml_list(\"data/test_data/login.yaml\"))\n    def test_login(self,data):\n        \"\"\"测试登录接口\"\"\"\n    \n        encryptor = PasswordEncryptor()\n        # public_key=read_yaml(\"config/extract.yaml\")[\"publicKey\"]\n        public_key = PUBLIC_KEY\n        pem_public_key = \"-----BEGIN PUBLIC KEY-----\" + public_key + \"-----END PUBLIC KEY-----\"\n        encryptor.set_public_key(pem_public_key)\n    \n        data[\"steps\"][\"request\"][\"json\"][\"password\"] = encryptor.encryptPassword(data[\"steps\"][\"request\"][\"json\"][\"password\"])\n        data[\"steps\"][\"request\"][\"json\"][\"timestamp\"] = int(time.time() * 1000)\n    \n        runner = ApiRunner(data)\n>       runner.run()\n\ntestcases\\test_login_api.py:37: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\ncommon\\api_utils.py:76: in run\n    self.core(k,v)\ncommon\\api_utils.py:62: in core\n    self.check_response(v)\ncommon\\api_utils.py:34: in check_response\n    checker.check_response(expected)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <common.response_checker.ResponseChecker object at 0x0000024341565DC0>\nexpected = {'response': {'code': 401, 'data': None, 'msg': '用户名或密码错误'}, 'status_code': 200}\n\n    def check_response(self, expected=None):\n        if expected is None:\n            logger.info(\"未设置预期结果，跳过断言\")\n            return\n    \n        errors = []\n        json_data = self.resp.json()\n        logger.info(f\"resp.json: {json_data}\")\n    \n        # 1. HTTP 状态码\n        if \"status_code\" in expected:\n            if self.resp.status_code != expected[\"status_code\"]:\n                errors.append(f\"状态码: 期望 {expected['status_code']}, 实际 {self.resp.status_code}\")\n    \n        # 2. 顶层字段 (code, msg)\n        resp_config = expected.get(\"response\", {})\n        for k, v in resp_config.items():\n            if k == \"data\":\n                continue\n            if k not in json_data:\n                errors.append(f\"缺少响应字段: {k}\")\n            elif json_data[k] != v:\n                errors.append(f\"响应字段: 期望 {k}={v!r}, 实际 {json_data[k]!r}\")\n    \n        # 3. data 层\n        data_config = resp_config.get(\"data\")\n        if data_config and \"data\" in json_data:\n            data = json_data[\"data\"]\n    \n            if \"required_fields\" in data_config:\n                for field in data_config[\"required_fields\"]:\n                    if field and field not in data:\n                        errors.append(f\"缺少字段: data.{field}\")\n    \n            if \"assert\" in data_config:\n                _run_assertions(data, data_config[\"assert\"], \"data\", errors)\n    \n            if \"list_check\" in data_config:\n                _check_list(data, data_config[\"list_check\"], \"data\", errors)\n    \n        # 4. 结果\n        if errors:\n            msg = f\"共 {len(errors)} 个断言失败:\\n\" + \"\\n\".join(f\"  - {e}\" for e in errors)\n            logger.error(msg)\n>           raise AssertionError(msg)\nE           AssertionError: 共 1 个断言失败:\nE             - 响应字段: 期望 code=401, 实际 400\n\ncommon\\response_checker.py:140: AssertionError","steps":[],"attachments":[{"uid":"df21e5c679c4d179","name":"log","source":"df21e5c679c4d179.txt","type":"text/plain","size":1241}],"parameters":[],"attachmentsCount":1,"shouldDisplayMessage":true,"stepsCount":0,"attachmentStep":false,"hasContent":true},"afterStages":[{"name":"setup_and_teardown::0","time":{"start":1770642206653,"stop":1770642206654,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"attachmentsCount":0,"shouldDisplayMessage":false,"stepsCount":0,"attachmentStep":false,"hasContent":false}],"labels":[{"name":"epic","value":"InvEntropy"},{"name":"feature","value":"登录模块"},{"name":"story","value":"登录接口"},{"name":"tag","value":"登录"},{"name":"tag","value":"接口测试"},{"name":"tag","value":"api"},{"name":"parentSuite","value":"testcases"},{"name":"suite","value":"test_login_api"},{"name":"subSuite","value":"TestLoginAPI"},{"name":"host","value":"Hsyuan"},{"name":"thread","value":"172904-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"testcases.test_login_api"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"data","value":"{'allure': {'title': '登录接口失败测试用例', 'description': '测试登录接口，使用错误的管理员账号和密码（RSA加密密码）', 'epic': 'InvEntropy', 'feature': '登录模块', 'story': '登录接口', 'tag': ['登录', '接口测试'], 'pytest_mark': 'api'}, 'steps': {'request': {'method': 'POST', 'url': '/login', 'json': {'username': 'admin', 'password': '123446', 'userType': 'admin', 'timestamp': '${timestamp}'}, 'params': {}, 'headers': {}}, 'expected': {'status_code': 200, 'response': {'code': 401, 'msg': '用户名或密码错误', 'data': None}}}}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":["登录","api","接口测试"]},"source":"b5c5ca70faad9e3e.json","parameterValues":["{'allure': {'title': '登录接口失败测试用例', 'description': '测试登录接口，使用错误的管理员账号和密码（RSA加密密码）', 'epic': 'InvEntropy', 'feature': '登录模块', 'story': '登录接口', 'tag': ['登录', '接口测试'], 'pytest_mark': 'api'}, 'steps': {'request': {'method': 'POST', 'url': '/login', 'json': {'username': 'admin', 'password': '123446', 'userType': 'admin', 'timestamp': '${timestamp}'}, 'params': {}, 'headers': {}}, 'expected': {'status_code': 200, 'response': {'code': 401, 'msg': '用户名或密码错误', 'data': None}}}}"]}