change_password_normal_correct_old_and_new_password:
  allure:
    title: "修改密码-正常场景-正确旧密码和新密码修改成功"
    description: "验证用户使用正确的旧密码和符合规则的新密码，能够成功修改密码，接口返回业务码200"
    epic: "用户中心系统"
    feature: "用户认证模块"
    story: "修改密码"
    tag: ["正常场景", "核心功能"]
    pytest_mark: "smoke"
  steps:
    request:
      method: "PUT"
      url: "/user/changePassword"
      headers:
        Content-Type: "application/json"
        Authorization: "${token}"
      json:
        id: 1001
        username: "zhangsan"
        password: "new_password_123"
        userType: "user"
    expected:
      status_code: 200
      response:
        code: 200
        msg: "success"
        data:
          required_fields: []
        assert:
          eq:
            code: 200
          contains:
            msg: "success"

change_password_abnormal_old_password_incorrect:
  allure:
    title: "修改密码-异常场景-旧密码错误导致修改失败"
    description: "验证用户使用错误的旧密码尝试修改密码时，接口应拒绝请求并返回业务码400及相应提示"
    epic: "用户中心系统"
    feature: "用户认证模块"
    story: "修改密码"
    tag: ["异常场景", "安全校验"]
    pytest_mark: "regression"
  steps:
    request:
      method: "PUT"
      url: "/user/changePassword"
      headers:
        Content-Type: "application/json"
        Authorization: "${token}"
      json:
        id: 1001
        username: "zhangsan"
        password: "wrong_old_password"
        userType: "user"
    expected:
      status_code: 200
      response:
        code: 400
        msg: "原密码错误"
        data:
          required_fields: []
        assert:
          eq:
            code: 400
          contains:
            msg: "原密码错误"

change_password_abnormal_missing_required_field_password:
  allure:
    title: "修改密码-异常场景-缺少必填字段password"
    description: "验证当请求体中缺少必填字段password时，接口是否进行参数校验并返回合理的错误提示"
    epic: "用户中心系统"
    feature: "用户认证模块"
    story: "修改密码"
    tag: ["异常场景", "参数校验"]
    pytest_mark: "regression"
  steps:
    request:
      method: "PUT"
      url: "/user/changePassword"
      headers:
        Content-Type: "application/json"
        Authorization: "${token}"
      json:
        id: 1001
        username: "zhangsan"
        userType: "user"
    expected:
      status_code: 200
      response:
        code: 400
        msg: "密码不能为空"
        data:
          required_fields: []
        assert:
          eq:
            code: 400
          contains:
            msg: "密码不能为空"

change_password_abnormal_password_too_short:
  allure:
    title: "修改密码-边界场景-新密码长度小于最小要求"
    description: "验证当新密码长度不足（如少于6位）时，接口是否进行有效性校验并返回合理提示"
    epic: "用户中心系统"
    feature: "用户认证模块"
    story: "修改密码"
    tag: ["边界场景", "输入验证"]
    pytest_mark: "regression"
  steps:
    request:
      method: "PUT"
      url: "/user/changePassword"
      headers:
        Content-Type: "application/json"
        Authorization: "${token}"
      json:
        id: 1001
        username: "zhangsan"
        password: "123"
        userType: "user"
    expected:
      status_code: 200
      response:
        code: 400
        msg: "密码长度不能少于6位"
        data:
          required_fields: []
        assert:
          eq:
            code: 400
          contains:
            msg: "密码长度不能少于6位"

change_password_unauthorized_no_token:
  allure:
    title: "修改密码-异常场景-未携带Token进行访问"
    description: "验证未登录用户尝试修改密码时，接口是否拒绝访问并返回401或对应权限错误码"
    epic: "用户中心系统"
    feature: "用户认证模块"
    story: "修改密码"
    tag: ["异常场景", "权限控制"]
    pytest_mark: "security"
  steps:
    request:
      method: "PUT"
      url: "/user/changePassword"
      headers:
        Content-Type: "application/json"
      json:
        id: 1001
        username: "zhangsan"
        password: "new_password_123"
        userType: "user"
    expected:
      status_code: 401
      response:
        code: 401
        msg: "未授权访问，请先登录"
        data:
          required_fields: []
        assert:
          eq:
            code: 401
          contains:
            msg: "未授权访问"