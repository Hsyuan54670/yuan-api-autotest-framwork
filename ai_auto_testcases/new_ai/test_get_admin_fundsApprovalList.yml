get_funds_approval_list_normal_default_page_size:
  allure:
    title: "获取经费审批列表-正常场景-默认分页参数查询成功"
    description: "验证管理员使用默认分页参数（page=1, size=5）调用接口，能正常返回待审批经费申请列表，响应状态码200，业务码200"
    epic: "项目管理平台"
    feature: "经费审批模块"
    story: "获取经费审批列表"
    tag: ["正常场景", "分页查询"]
    pytest_mark: "smoke"
  steps:
    request:
      method: "GET"
      url: "/admin/fundsApprovalList"
      headers:
        Content-Type: "application/json"
        Authorization: "${admin_token}"
      params:
        page: 1
        size: 5
      json: {}
    expected:
      status_code: 200
      response:
        code: 200
        msg: "success"
        data:
          required_fields: ["records", "total", "pageNum", "pageSize"]
          assert:
            type:
              total: int
              pageNum: int
              pageSize: int
          list_check:
            records:
              length: 5
              every_item_required_fields:
                - "id"
                - "projectId"
                - "applicant"
                - "reason"
                - "appliedFunds"
                - "remainingFunds"
                - "applicantId"
                - "appliedTime"
            type:
              appliedFunds: float
              remainingFunds: float
            regex:
              appliedTime: "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$"
    extract:
      approval_list_total: $.data.total
      first_record_id: $.data.records[0].id

get_funds_approval_list_normal_custom_page_size:
  allure:
    title: "获取经费审批列表-正常场景-自定义每页条数查询成功"
    description: "验证管理员传入自定义分页参数（page=1, size=10）调用接口，能正确返回10条数据"
    epic: "项目管理平台"
    feature: "经费审批模块"
    story: "获取经费审批列表"
    tag: ["正常场景", "分页查询"]
    pytest_mark: "regression"
  steps:
    request:
      method: "GET"
      url: "/admin/fundsApprovalList"
      headers:
        Content-Type: "application/json"
        Authorization: "${admin_token}"
      params:
        page: 1
        size: 10
      json: {}
    expected:
      status_code: 200
      response:
        code: 200
        msg: "success"
        data:
          required_fields: ["records", "total", "pageNum", "pageSize"]
          assert:
            eq:
              pageNum: 1
              pageSize: 10
            type:
              total: int
          list_check:
            records:
              length: 10
              every_item_required_fields:
                - "id"
                - "projectId"
                - "applicant"
                - "reason"
                - "appliedFunds"
                - "remainingFunds"
                - "applicantId"
                - "appliedTime"

get_funds_approval_list_abnormal_unauthorized:
  allure:
    title: "获取经费审批列表-异常场景-未登录访问被拒绝"
    description: "验证未携带token的用户访问接口时，返回401或403，提示权限不足"
    epic: "项目管理平台"
    feature: "经费审批模块"
    story: "获取经费审批列表"
    tag: ["异常场景", "权限校验"]
    pytest_mark: "security"
  steps:
    request:
      method: "GET"
      url: "/admin/fundsApprovalList"
      headers:
        Content-Type: "application/json"
      params: {}
      json: {}
    expected:
      status_code: 401
      response:
        code: 401
        msg: "Unauthorized"
        data: null

get_funds_approval_list_boundary_page_zero:
  allure:
    title: "获取经费审批列表-边界场景-页码为0按默认处理"
    description: "验证当page=0时，接口是否按默认值1处理并正常返回数据"
    epic: "项目管理平台"
    feature: "经费审批模块"
    story: "获取经费审批列表"
    tag: ["边界场景", "参数容错"]
    pytest_mark: "boundary"
  steps:
    request:
      method: "GET"
      url: "/admin/fundsApprovalList"
      headers:
        Content-Type: "application/json"
        Authorization: "${admin_token}"
      params:
        page: 0
        size: 5
      json: {}
    expected:
      status_code: 200
      response:
        code: 200
        msg: "success"
        data:
          assert:
            eq:
              pageNum: 1
          required_fields: ["records", "total"]

get_funds_approval_list_boundary_size_out_of_range:
  allure:
    title: "获取经费审批列表-边界场景-每页条数超出范围"
    description: "验证当size=1000时，接口是否限制最大返回数量或返回错误提示"
    epic: "项目管理平台"
    feature: "经费审批模块"
    story: "获取经费审批列表"
    tag: ["边界场景", "参数校验"]
    pytest_mark: "boundary"
  steps:
    request:
      method: "GET"
      url: "/admin/fundsApprovalList"
      headers:
        Content-Type: "application/json"
        Authorization: "${admin_token}"
      params:
        page: 1
        size: 1000
      json: {}
    expected:
      status_code: 200
      response:
        code: 200
        msg: "success"
        data:
          assert:
            type:
              pageSize: int
          list_check:
            records:
              length: 500