{"uid":"4ebfa570426afc6b","name":"提交项目-边界场景-经费为零","fullName":"testcases.test_user_api.TestUserAPI#test_get_projects_approval_list","historyId":"bf456f45e99337af85a0fdfd6ec03c8c","time":{"start":1771745417297,"stop":1771745417581,"duration":284},"description":"验证funds为0时，接口的处理方式","descriptionHtml":"<p>验证funds为0时，接口的处理方式</p>\n","status":"failed","statusMessage":"AssertionError: 共 1 个断言失败:\n  - 响应字段: 期望 code=400, 实际 200","statusTrace":"self = <test_user_api.TestUserAPI object at 0x7fe6fc9783e0>\ndata = {'allure': {'description': '验证funds为0时，接口的处理方式', 'epic': '项目管理平台', 'feature': '项目申请模块', 'story': '提交项目', ...}, 'steps'...aliyuncs.com/2026/02/项目13.docx', 'deadline': '2026-02-28T00:00:00', ...}, 'method': 'POST', 'url': '/project/submit'}}}\nget_user_token = <requests.sessions.Session object at 0x7fe6fca03230>\n\n    @pytest.mark.parametrize(\"data\", get_testcases(\"data/ai_testcases/user\"))\n    @pytest.mark.api\n    @pytest.mark.final\n    def test_get_projects_approval_list(self, data,get_user_token):\n    \n        runner = ApiRunner(data,get_user_token)\n>       runner.run()\n\ntestcases/test_user_api.py:16: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ncommon/api_utils.py:88: in run\n    self.core(k,v)\ncommon/api_utils.py:74: in core\n    self.check_response(v)\ncommon/api_utils.py:46: in check_response\n    checker.check_response(expected)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <common.response_checker.ResponseChecker object at 0x7fe6fc9d1be0>\nexpected = {'response': {'code': 400}, 'status_code': 200}\n\n    def check_response(self, expected=None):\n        if expected is None:\n            logger.info(\"未设置预期结果，跳过断言\")\n            return\n    \n        if self.resp is None:\n            raise AssertionError(\"请求失败，响应对象为空\")\n    \n        errors = []\n    \n        # 处理非JSON响应的错误\n        try:\n            json_data = self.resp.json()\n        except Exception:\n            json_data = {}\n    \n        logger.info(f\"resp.json: {json_data}\")\n    \n        # 1. HTTP 状态码\n        if \"status_code\" in expected:\n            if self.resp.status_code != expected[\"status_code\"]:\n                errors.append(f\"状态码: 期望 {expected['status_code']}, 实际 {self.resp.status_code}\")\n    \n        # 2. 顶层字段 (code, msg)\n        resp_config = expected.get(\"response\", {})\n        for k, v in resp_config.items():\n            if k == \"data\":\n                continue\n            if k not in json_data:\n                errors.append(f\"缺少响应字段: {k}\")\n            elif json_data[k] != v:\n                errors.append(f\"响应字段: 期望 {k}={v!r}, 实际 {json_data[k]!r}\")\n    \n        # 3. data 层\n        data_config = resp_config.get(\"data\")\n        if data_config and \"data\" in json_data:\n            data = json_data[\"data\"]\n    \n            if \"required_fields\" in data_config:\n                for field in data_config[\"required_fields\"]:\n                    if field and field not in data:\n                        errors.append(f\"缺少字段: data.{field}\")\n    \n            if \"assert\" in data_config:\n                _run_assertions(data, data_config[\"assert\"], \"data\", errors)\n    \n            if \"list_check\" in data_config:\n                _check_list(data, data_config[\"list_check\"], \"data\", errors)\n    \n            if \"list_data\" in data_config:\n                _check_list_data(data,data_config[\"list_data\"], \"data\", errors)\n    \n    \n        # 4. 结果\n        if errors:\n            msg = f\"共 {len(errors)} 个断言失败:\\n\" + \"\\n\".join(f\"  - {e}\" for e in errors)\n            logger.error(msg)\n>           raise AssertionError(msg)\nE           AssertionError: 共 1 个断言失败:\nE             - 响应字段: 期望 code=400, 实际 200\n\ncommon/response_checker.py:180: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup_and_teardown","time":{"start":1771745398089,"stop":1771745398089,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"get_user_token","time":{"start":1771745414131,"stop":1771745414692,"duration":561},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"验证funds为0时，接口的处理方式","status":"failed","statusMessage":"AssertionError: 共 1 个断言失败:\n  - 响应字段: 期望 code=400, 实际 200","statusTrace":"self = <test_user_api.TestUserAPI object at 0x7fe6fc9783e0>\ndata = {'allure': {'description': '验证funds为0时，接口的处理方式', 'epic': '项目管理平台', 'feature': '项目申请模块', 'story': '提交项目', ...}, 'steps'...aliyuncs.com/2026/02/项目13.docx', 'deadline': '2026-02-28T00:00:00', ...}, 'method': 'POST', 'url': '/project/submit'}}}\nget_user_token = <requests.sessions.Session object at 0x7fe6fca03230>\n\n    @pytest.mark.parametrize(\"data\", get_testcases(\"data/ai_testcases/user\"))\n    @pytest.mark.api\n    @pytest.mark.final\n    def test_get_projects_approval_list(self, data,get_user_token):\n    \n        runner = ApiRunner(data,get_user_token)\n>       runner.run()\n\ntestcases/test_user_api.py:16: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \ncommon/api_utils.py:88: in run\n    self.core(k,v)\ncommon/api_utils.py:74: in core\n    self.check_response(v)\ncommon/api_utils.py:46: in check_response\n    checker.check_response(expected)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <common.response_checker.ResponseChecker object at 0x7fe6fc9d1be0>\nexpected = {'response': {'code': 400}, 'status_code': 200}\n\n    def check_response(self, expected=None):\n        if expected is None:\n            logger.info(\"未设置预期结果，跳过断言\")\n            return\n    \n        if self.resp is None:\n            raise AssertionError(\"请求失败，响应对象为空\")\n    \n        errors = []\n    \n        # 处理非JSON响应的错误\n        try:\n            json_data = self.resp.json()\n        except Exception:\n            json_data = {}\n    \n        logger.info(f\"resp.json: {json_data}\")\n    \n        # 1. HTTP 状态码\n        if \"status_code\" in expected:\n            if self.resp.status_code != expected[\"status_code\"]:\n                errors.append(f\"状态码: 期望 {expected['status_code']}, 实际 {self.resp.status_code}\")\n    \n        # 2. 顶层字段 (code, msg)\n        resp_config = expected.get(\"response\", {})\n        for k, v in resp_config.items():\n            if k == \"data\":\n                continue\n            if k not in json_data:\n                errors.append(f\"缺少响应字段: {k}\")\n            elif json_data[k] != v:\n                errors.append(f\"响应字段: 期望 {k}={v!r}, 实际 {json_data[k]!r}\")\n    \n        # 3. data 层\n        data_config = resp_config.get(\"data\")\n        if data_config and \"data\" in json_data:\n            data = json_data[\"data\"]\n    \n            if \"required_fields\" in data_config:\n                for field in data_config[\"required_fields\"]:\n                    if field and field not in data:\n                        errors.append(f\"缺少字段: data.{field}\")\n    \n            if \"assert\" in data_config:\n                _run_assertions(data, data_config[\"assert\"], \"data\", errors)\n    \n            if \"list_check\" in data_config:\n                _check_list(data, data_config[\"list_check\"], \"data\", errors)\n    \n            if \"list_data\" in data_config:\n                _check_list_data(data,data_config[\"list_data\"], \"data\", errors)\n    \n    \n        # 4. 结果\n        if errors:\n            msg = f\"共 {len(errors)} 个断言失败:\\n\" + \"\\n\".join(f\"  - {e}\" for e in errors)\n            logger.error(msg)\n>           raise AssertionError(msg)\nE           AssertionError: 共 1 个断言失败:\nE             - 响应字段: 期望 code=400, 实际 200\n\ncommon/response_checker.py:180: AssertionError","steps":[],"attachments":[{"uid":"3dbe6c25a2c32546","name":"log","source":"3dbe6c25a2c32546.txt","type":"text/plain","size":935}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"get_user_token::0","time":{"start":1771745424132,"stop":1771745424133,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_and_teardown::0","time":{"start":1771745424133,"stop":1771745424133,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"epic","value":"项目管理平台"},{"name":"feature","value":"项目申请模块"},{"name":"story","value":"提交项目"},{"name":"tag","value":"边界场景"},{"name":"tag","value":"参数校验"},{"name":"tag","value":"final"},{"name":"tag","value":"api"},{"name":"parentSuite","value":"testcases"},{"name":"suite","value":"test_user_api"},{"name":"subSuite","value":"TestUserAPI"},{"name":"host","value":"runnervmwffz4"},{"name":"thread","value":"2423-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"testcases.test_user_api"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"data","value":"{'allure': {'title': '提交项目-边界场景-经费为零', 'description': '验证funds为0时，接口的处理方式', 'epic': '项目管理平台', 'feature': '项目申请模块', 'story': '提交项目', 'tag': ['边界场景', '参数校验']}, 'steps': {'request': {'method': 'POST', 'url': '/project/submit', 'headers': {}, 'json': {'projectName': '项目${uuid}', 'projectType': '横向项目', 'applicant': '小红', 'applicantId': '', 'funds': 0, 'content': 'https://inventropy.oss-cn-hangzhou.aliyuncs.com/2026/02/项目13.docx', 'deadline': '2026-02-28T00:00:00'}}, 'expected': {'status_code': 200, 'response': {'code': 400}}}}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":["边界场景","参数校验","final","api"]},"source":"4ebfa570426afc6b.json","parameterValues":["{'allure': {'title': '提交项目-边界场景-经费为零', 'description': '验证funds为0时，接口的处理方式', 'epic': '项目管理平台', 'feature': '项目申请模块', 'story': '提交项目', 'tag': ['边界场景', '参数校验']}, 'steps': {'request': {'method': 'POST', 'url': '/project/submit', 'headers': {}, 'json': {'projectName': '项目${uuid}', 'projectType': '横向项目', 'applicant': '小红', 'applicantId': '', 'funds': 0, 'content': 'https://inventropy.oss-cn-hangzhou.aliyuncs.com/2026/02/项目13.docx', 'deadline': '2026-02-28T00:00:00'}}, 'expected': {'status_code': 200, 'response': {'code': 400}}}}"]}